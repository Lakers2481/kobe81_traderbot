[pytest]
# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Warning filters - suppress known third-party library deprecation warnings
filterwarnings =
    # Ignore pandas_datareader distutils deprecation (third-party library issue)
    ignore:distutils Version classes are deprecated:DeprecationWarning:pandas_datareader
    # Ignore yfinance internal warnings
    ignore::DeprecationWarning:yfinance
    # Ignore datetime deprecation in Python 3.12+ (utcnow, utcfromtimestamp)
    ignore:.*utcnow.*:DeprecationWarning
    ignore:.*utcfromtimestamp.*:DeprecationWarning
    # Ignore asyncio deprecation warnings from third-party libs
    ignore::DeprecationWarning:asyncio
    # Ignore FutureWarning from pandas (common in data science libs)
    ignore::FutureWarning:pandas
    ignore::FutureWarning:numpy
    # Ignore websockets.legacy deprecation (alpaca-trade-api uses old websockets)
    ignore:websockets.legacy is deprecated:DeprecationWarning:websockets
    # Ignore Pydantic V2 class-based config deprecation
    ignore:Support for class-based `config` is deprecated:DeprecationWarning:pydantic
    # Ignore DataFrame fragmentation warning (performance only, not functional)
    ignore:DataFrame is highly fragmented:pandas.errors.PerformanceWarning
    # Ignore intentional deprecation warnings from our modules (guide users to new code)
    ignore::DeprecationWarning:cognitive
    ignore::DeprecationWarning:ml_features
    # Ignore FutureWarning from research module (vectorbt/pandas pct_change)
    ignore::FutureWarning:research
    # Ignore UserWarning from vectorbt multi-column aggregation (in our research module)
    ignore::UserWarning:research.vectorbt_miner
    ignore::UserWarning:research
    # Don't convert deprecation warnings to errors - too strict for multi-version support
    # error::DeprecationWarning

# Markers
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    e2e: marks tests as end-to-end (full pipeline)
    requires_mock_broker: requires mocked Alpaca API
    requires_mock_data: requires mocked data providers
    kill_zone: tests time-based blocking
    concurrent: tests multi-threading scenarios
    recovery: tests crash/failure recovery
    stress: marks tests as stress tests (high load)

# Output options
addopts = -v --tb=short

# Timeout for long-running tests (optional, requires pytest-timeout)
# timeout = 300
